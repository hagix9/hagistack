---

- name: install mysql pkg
  apt: >
    name={{ item }}
    state=present
  with_items: mysql_server_pkgs

- name: set my.cnf
  template: >
    src=my.cnf.j2
    dest=/etc/mysql/my.cnf
    owner=root
    group=root
    mode=0664
  notify:
    - restart mysql

- name: start mysql
  service: >
    name=mysql
    state=started enabled=yes

- name: check .my.cnf exists or not
  stat: "path={{ mysql_root_home }}/.my.cnf"
  register: mycnf_file

- name: set root password
  mysql_user: >
    name=root
    host={{ item }}
    password={{ mysql_root_password }}
  with_items: mysql_root_hosts
  when: not mycnf_file.stat.exists

- name: set root password file
  template: >
    src=.my.cnf.j2
    dest={{ mysql_root_home }}/.my.cnf
    owner=root group=root mode=600

- name: anonymous user delete
  mysql_user: >
    name=""
    state=absent
 
- name: remove mysql test database
  mysql_db: >
    name=test
    state=absent

